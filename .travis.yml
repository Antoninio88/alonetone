language: ruby
cache: 
  - bundler
  - yarn
  - directories
    - "node_modules"
before_install:
- npm i -g node@latest
- sudo apt-get update -qq
- sudo apt-get install -y libsndfile-dev lame
- yarn
before_script:
- mysql -e 'create database alonetone_test';
- gem update --system
- bundle exec rake copy_config
- bundle exec rake db:drop
- bundle exec rake db:create
- bundle exec rake db:schema:load
- bundle exec rake db:seed
script: bundle exec rake spec
notifications:
  email:
    on_success: never
    on_failure: never
  slack:
    on_success: always
    on_failure: always
    template:
      - ":%{result}: Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) by %{author}"
    rooms:
      secure: QM0e0lpejQw6F19tYUx6kPP3+/DjgJaCmuKIVKSmF+Dedoz/DVwIPdDadwKxnvfoDT/QKr8+KeaJHhis6iJEPeKffb2Jm7U0Z6bjpgtzQ0LnXGtpRhUuoJvzZqlP4oQQgKvQy83VpigXKcM0QvODgIWev4X7/aPPKqaDEBrHO0A=
env:
  global:
  - S3_BUCKET_NAME=junkinthetrunk
  - secure: O45V0oniMMy2SfZ4GlCafzkPyvbNvf+ppUd9hu82RLQpANI7l7NKGa7gCW/FYlcDDcIuUkut6D21eEWwPG0x8bLqSIoE9x5kSK6xuOoqCKHkznWxsfMVI+CjoVAkekvS8iDlnu3BTIa7m0264uaJovGhUDWN43YJ+Z9sRxwYh8g=
